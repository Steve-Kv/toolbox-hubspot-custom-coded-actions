# üì© HubSpot SMS Response Logger (Custom Code Action)

This custom code action is designed to create a SMS communication record in **HubSpot CRM**, associating it with the relevant **Deal** and optionally the **Contact**.

It's built for use within a **HubSpot workflow**, where it runs automatically when the right conditions are met (e.g. after receiving an SMS via Talkdesk/Textline).

The usecase here is to work around limitations with integrations between Hubspot and 3rd party SMS systems like TextLine, Talkdesk, Sakari. These integrations often do not contain the ability to log an activity records against objects other than contact (deals, tickets, custom objects, etc).

You can adapt this code for other activity types, for example, logging an email against a deal record.
---

## üß† What It Does

- Automatically enrols deals in a workflow where:
  - The deal record's `sms_sent_received_date_time` property becomes known
  - AND
  - The deal record's `sms_sent_received_message` property becomes known
- Runs an action that: 
  - Creates a **communication record** in HubSpot with channel type `SMS`
    - Sets the record's create date/time to the value of the enrolled deal record's `XXX` property
    - Sets the record's communication body to the value of the enrolled deal record's `XXX` property
    - Sets the record's activity owner to the deal record's `Deal Owner` (if available)
- Associates the communication with:
  - The enrolled **Deal** record within the workflow (required)
  - The primary **Contact** record that is associated to the enrolled **Deal** (optional)
- Tags the communication with the HubSpot owner
- Adds automated system notes for transparency

---

## ‚öôÔ∏è How to Use

1. **Create a Workflow**  
   In HubSpot, set up a Deal-based workflow and configure your enrollment trigger (e.g., property indicating an SMS reply has been logged externally).

2. **Add a "Custom Code" Action**  
   Within the workflow, insert a **Custom Code** action.

3. **Set Input Fields**  
   Add the following **Input Fields** to pass into your code:

   | Field Name                              | Example Value                     | Required | Description                                      |
   |----------------------------------------|-----------------------------------|----------|--------------------------------------------------|
   | `log_response_to_sms_outreach_datetime` | `2025-06-05T09:00:00Z`            | ‚úÖ       | Date/time the SMS was received (ISO 8601)        |
   | `log_response_to_sms_outreach_message`  | `"Sure, sounds good!"`            | ‚ùå       | The actual SMS message content                   |
   | `hubspot_owner_id`                      | `12345678`                        | ‚úÖ       | The HubSpot owner ID responsible for the deal    |
   | `contact_hs_object_id`                  | `987654321`                       | ‚ùå       | The contact‚Äôs HubSpot ID (if available)          |

4. **Set Secret (Private App Token)**  
   In the **Secrets** tab of the code action, add the following:

   | Secret Name     | Description                                  |
   |-----------------|----------------------------------------------|
   | `cca_activities` | Your HubSpot private app token (with `crm.objects.communications.write` scope) |

5. **Paste in the Python Script**  
   Copy the contents of [`sms_logger.py`](./sms_logger.py) into the code editor and save the action.

---

## üìù Example Output

A communication will be created in HubSpot, appearing in the deal timeline with:

- Type: **SMS**
- Source: **CRM**
- Message: The guest's SMS reply, formatted for clarity
- Notes: Includes an autogenerated tag and system caveats (e.g., if no contact is associated)

---

## ‚úÖ Tips

- If no message is passed in, the record will still be created with a fallback note.
- If no contact is provided, the system will mention this in the communication body so it‚Äôs not silently missed.
- Consider pairing this with a webhook or Talkdesk/Textline integration that updates a custom property when a new SMS reply is received.

---

## üìÑ License

MIT ‚Äì feel free to use, adapt, and build upon it for your team‚Äôs CRM automation needs. Just sent some love my way if it's been useful! :)

---


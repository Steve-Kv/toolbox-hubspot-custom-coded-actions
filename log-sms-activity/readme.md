# üì© HubSpot SMS Response Logger (Custom Code Action)

This custom code action is designed to create a SMS communication record in **HubSpot CRM**, associating it with the relevant **Deal** and optionally the **Contact**.

It's built for use within a **HubSpot workflow**, where it runs automatically when the right conditions are met (e.g. after receiving an SMS via Talkdesk/Textline).

The usecase here is to work around limitations with integrations between Hubspot and 3rd party SMS systems like TextLine, Talkdesk, Sakari. These integrations often do not contain the ability to log an activity records against objects other than contact (deals, tickets, custom objects, etc).

You can adapt this code for other activity types, for example, logging an email against a deal record.
---

## üß† What It Does

- Automatically enrols deals in a workflow where:
  - The deal record's `sms_sent_received_date_time` property becomes known
  - AND
  - The deal record's `sms_sent_received_message` property becomes known
- Runs an action that: 
  - Creates a **communication record** in HubSpot with channel type `SMS`
    - Sets the record's create date/time to the value of the enrolled deal record's `XXX` property
    - Sets the record's communication body to the value of the enrolled deal record's `XXX` property
    - Sets the record's activity owner to the deal record's `Deal Owner` (if available)
- Associates the communication with:
  - The enrolled **Deal** record within the workflow (required)
  - The primary **Contact** record that is associated to the enrolled **Deal** (optional)
- Adds automated system notes into the communication body for transparency

---

## ‚öôÔ∏è How to Use

1. **Create a Workflow**  
   In HubSpot, set up a Deal-based workflow and configure your enrollment trigger:
     - `sms_sent_received_date_time` is `known`
  
  Note: `sms_sent_received_message` is not mandatory for this code to work, but can be added here as `known`

3. **Add a "Custom Code" Action**  
   Within the workflow, insert a **Custom Code** action.

4. **Set Input Fields**  
   Add the following **Input Fields** to pass into your code:

   | Field Name                             | Example Value                     | Required | Description                                      |
   |----------------------------------------|-----------------------------------|----------|--------------------------------------------------|
   | `sms_sent_received_date_time`          | `2025-06-05T09:00:00Z`            | ‚úÖ       | Date/time the SMS was received (ISO 8601)        |
   | `sms_sent_received_message`            | `"Sure, sounds good!"`            | ‚ùå       | The actual SMS message content                   |
   | `hubspot_owner_id`                     | `12345678`                        | ‚úÖ       | The HubSpot owner ID responsible for the deal    |
   | `contact_hs_object_id`                 | `987654321`                       | ‚ùå       | The contact‚Äôs HubSpot ID (if available)          |

   Note: To retrieve the contact record ID, add the target associated contact record to the available records of the workflow. (e.g. First associated contact to deal)

5. **Set Secret (Private App Token)**  
   In the **Secrets** tab of the code action, add the following:

   | Secret Name     | Description                                  |
   |-----------------|----------------------------------------------|
   | `cca_activities` | Your HubSpot private app token (with the scopes `crm.objects.contacts.write`, `crm.objects.deals.read`, `crm.objects.deals.write`, `crm.objects.contacts.read` scopes) |

6. **Paste in the Python Script**  
   Copy the contents of [`sms_logger.py`](./sms_logger.py) into the code editor and save the action.

---

## üìù Example Output

A communication will be created in HubSpot, appearing in the deal timeline with:

- Type: **SMS**
- Source: **CRM**
- Message: The guest's SMS reply, formatted for clarity
- Notes: Includes an autogenerated tag and system caveats (e.g., if no contact is associated)

---

## ‚úÖ Tips

- If no message is passed in, the record will still be created with a fallback note.
- If no contact is provided, the system will mention this in the communication body so it‚Äôs not silently missed.
- You may want to add a branch action following the custom code action and set it up to check if the code rans successfully or not. Then setting up an alert notification if it fails.
- You may want to add actions to clear the `sms_sent_received_date_time` and `sms_sent_received_message` properties once the code has successfully run. This will allow the properties to become available once again for population and for workflow re-enrolment criteria to be turned on.
- SMS communications records currently (As of June 2025) do not have a `Direction` property, the SMS message logged in this set up example doesn't define the direction.

---

## üìÑ License

Feel free to use, adapt, and build upon it for your team‚Äôs CRM automation needs. Just sent some love my way if it's been useful! :)

---

